// Generated by CoffeeScript 1.4.0
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['reading-window', 'hacking-window', 'github-window', 'listening-window'], function(ReadingWindow, HackingWindow, GithubWindow, ListeningWindow) {
  var HEADER_PADDING, MainApp, MainPage, MainRouter, TweetCollection, TweetManager, TweetView, app;
  HEADER_PADDING = 45;
  MainApp = (function(_super) {

    __extends(MainApp, _super);

    function MainApp() {
      return MainApp.__super__.constructor.apply(this, arguments);
    }

    return MainApp;

  })(Backbone.Marionette.Application);
  app = new MainApp;
  app.addInitializer(function() {
    var router;
    router = new MainRouter;
    return Backbone.history.start({
      root: '/',
      pushState: true
    });
  });
  MainRouter = (function(_super) {

    __extends(MainRouter, _super);

    function MainRouter() {
      return MainRouter.__super__.constructor.apply(this, arguments);
    }

    MainRouter.prototype.routes = {
      'bio/': 'showBio',
      'hacker/': 'showHacker'
    };

    MainRouter.prototype.initialize = function() {
      this.mainPage = new MainPage;
      this.reading = new ReadingWindow;
      this.hacking = new HackingWindow;
      this.git = new GithubWindow;
      return this.listening = new ListeningWindow;
    };

    MainRouter.prototype.showBio = function() {
      return this.mainPage.scrollToBio();
    };

    MainRouter.prototype.showHacker = function() {
      this.mainPage.scrollToHacker();
      return console.log('yay');
    };

    return MainRouter;

  })(Backbone.Router);
  MainPage = (function(_super) {

    __extends(MainPage, _super);

    function MainPage() {
      return MainPage.__super__.constructor.apply(this, arguments);
    }

    MainPage.prototype.el = 'body';

    MainPage.prototype.events = {
      'click .nav-link': 'navigateTo'
    };

    MainPage.prototype.regions = {
      'tweets': '.tweets'
    };

    MainPage.prototype.initialize = function() {
      _.bindAll(this, 'detectScroll');
      return this.detectScroll();
    };

    MainPage.prototype.detectScroll = function(event) {
      var $hackerHeader, hackerTop,
        _this = this;
      this.headerH = $('.header-main').outerHeight();
      $hackerHeader = $('.header-hacker');
      hackerTop = $hackerHeader.offset().top - (this.headerH - HEADER_PADDING);
      return $(window).scroll(function(event) {
        var hackerMovement, top;
        top = $(window).scrollTop();
        hackerMovement = $('.header-hacker').offset().top;
        if (top >= hackerTop) {
          $('.header-offset').removeClass('absolute');
          $hackerHeader.addClass('fixed');
          $('.nav').addClass('fixed orange');
          $('.logo').addClass('fixed');
          Backbone.history.navigate('hacker/');
          return _this.toggleActive(void 0, 'hacker');
        } else {
          $('.header-offset').addClass('absolute');
          $hackerHeader.removeClass('fixed');
          $('.nav').removeClass('fixed orange');
          $('.logo').removeClass('fixed');
          Backbone.history.navigate('/');
          return _this.toggleActive(void 0, 'bio');
        }
      });
    };

    MainPage.prototype.scrollToHacker = function(event) {
      return $('html, body').animate({
        scrollTop: $("#hacker").offset().top
      }, 700);
    };

    MainPage.prototype.scrollToBio = function(event) {
      return $('html, body').animate({
        scrollTop: $("#bio").offset().top
      }, 700);
    };

    MainPage.prototype.navigateTo = function(event) {
      var data, route;
      data = $(event.currentTarget).data();
      event.preventDefault();
      route = data.route;
      Backbone.history.navigate(route, {
        trigger: true
      });
      return this.toggleActive(event, void 0);
    };

    MainPage.prototype.toggleActive = function(event, element) {
      $('.nav-link').removeClass('active');
      if (event) {
        $(event.target).addClass('active');
      }
      if (element) {
        $(".nav-link[data-route*=" + element + "]").addClass('active');
        return console.log("" + element);
      }
    };

    return MainPage;

  })(Backbone.Marionette.Layout);
  TweetView = (function(_super) {

    __extends(TweetView, _super);

    function TweetView() {
      return TweetView.__super__.constructor.apply(this, arguments);
    }

    TweetView.prototype.template = _.template($('#tweet-template').html());

    return TweetView;

  })(Backbone.Marionette.ItemView);
  TweetCollection = (function(_super) {

    __extends(TweetCollection, _super);

    function TweetCollection() {
      return TweetCollection.__super__.constructor.apply(this, arguments);
    }

    TweetCollection.prototype.itemView = TweetView;

    TweetCollection.prototype.itemViewOptions = {
      className: 'tweet block'
    };

    return TweetCollection;

  })(Backbone.Marionette.CollectionView);
  TweetManager = (function(_super) {

    __extends(TweetManager, _super);

    function TweetManager() {
      return TweetManager.__super__.constructor.apply(this, arguments);
    }

    TweetManager.prototype.template = _.template($('#tweets-layout').html());

    return TweetManager;

  })(Backbone.Marionette.Layout);
  return app.start();
});
